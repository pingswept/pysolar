/*! newsy 2016-04-28 */

/*!
 *  Project: Newsy
 *  Description: Pull news and events JSON data from the NREL N/E db. Provides basic templating on the front-end.
 *  Author: Michael Oakley
 *  License: MIT
 */
"use strict";(function(N,R,E,L){var a="newsy",b={url:"/news/server/cfc/",api:"news.cfc",type:"news",newsfunc:"getNewsHeadlines",releasefunc:"getNewsHeadlines",featurefunc:"getNewsHeadlines",eventsfunc:"getEventsHeadlines",sitenum:1,results:2,spinner:'<i class="fa fa-spinner fa-spin"></i>',releasetmpl:'<p class="headline"><a href="{{LINK}}">{{HEADLINE}}</a></p>'+'<p class="date">{{DATE_POSTED}}</p>',newstmpl:'<p class="headline"><a href="{{LINK}}">{{HEADLINE}}</a></p>'+'<p class="date">{{DATE_POSTED}}</p>',eventstmpl:'<div class="event">'+' <p class="headline"><a href="{{eventlink}}">{{title}}</a></p>'+' <p class="date">{{pretty_date_start}}</p>'+' <p class="location">{{city}}, {{state}}</p>'+"</div>",featuretmpl:"",customfunc:"",customtmpl:""};function c(c,d){this.element=c;this.settings=N.extend({},b,d);this._defaults=b;this._name=a;this.init()}N.extend(c.prototype,{init:function(){var a=this,b=this._name+"-spinner",c=N.Deferred(),d=this.settings[this.settings.type+"tmpl"]||this.settings.newstmpl;this.showSpinner(this.settings.spinner,b);c=this.getData();c.done(function(c,e,f){a.hideSpinner(b);a.updateUI.call(a,c,e,f,d)});c.fail(function(c,d){a.hideSpinner(b);a.updateUI.call(a,c,d)})},showSpinner:function(a,b){N("<div>",{id:b}).append(a).appendTo(this.element)},hideSpinner:function(a){N("#"+a).remove()},getData:function(){var a=this.settings,b=a[a.type+"func"]||a.newsfunc;return N.ajax({type:"GET",dataType:"json",url:a.url+a.api,data:{method:b,type:a.type,siteID:a.sitenum,numItems:a.results}})},updateUI:function(a,b,c,d){var e,f,g,h=N(this.element),i=this.settings,j;if(b==="error"){console.error("Newsy API failed to retrieve data");h.append("<p>No current news.</p>");return}if(!a.length){j=i.type.slice(-1)==="s"?"":"s";h.append("<p>No current news</p>");return}N.each(a,function(a,b){g=d;for(var c in b){f="{{"+c+"}}";e=new RegExp(f,"gi");g=g.replace(e,b[c])}h.append(g)})}});N.fn[a]=function(b){this.each(function(){if(!N.data(this,"plugin_"+a)){N.data(this,"plugin_"+a,new c(this,b))}});return this}})(jQuery,window,document);
//# sourceMappingURL=jquery.newsy.min.map